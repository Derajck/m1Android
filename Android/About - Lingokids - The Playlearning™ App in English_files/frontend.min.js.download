var WAPF;!function(g){var e=(t.prototype.dependencies=function(e){e.on("keyup change",'.wapf-input,input[name="variation_id"]',function(){g.Util.doDependencies(e)}),g.Util.doDependencies(e)},t.prototype.quantity=function(e){var t=e.find("[data-qty-based]");t.length&&(e.on("change",":input.qty",function(){g.Util.doQtyLogic(e,t)}),g.Util.doQtyLogic(e,t))},t.prototype.productImage=function(o,c){function i(){setTimeout(function(){jQuery(window).trigger("resize"),o.find(".images").trigger("woocommerce_gallery_init_zoom")},15)}function r(n){setTimeout(function(){var e=c[parseInt(n)],t=o.find("[data-wapf-att-id="+n+"]");if(t.length&&wapf_config.slider_support){var a=o.find(".images").data("flexslider");if(a){var r=a.vars?a.vars.animationSpeed:250;return u&&(a.vars.animationSpeed=0),o.find(".flex-control-nav li").eq(jQuery("[data-wapf-att-id]").index(t)).find("img").trigger("click"),a.vars.animationSpeed=r,u=!1,i()}}!function(t){p=o.find(".images .wp-post-image").eq(0),l.forEach(function(e){t[e]&&p.attr(e,t[e])}),t.srcset||p.attr("srcset",""),Object.keys(d).forEach(function(e){p.attr(e,t[d[e]])});var e=o.find(".flex-control-nav li").eq(0).find("img");e.attr("src",t.thumb_src),p.closest("a").attr("href",t.full_src),p.closest("div").attr("data-wapf-att-id",t.image_id),e.trigger("click"),i()}(e)},5)}function n(e,t,a){(a=function(e,t,a){for(var r=0;r<a.length;r++){for(var n=a[r],i=!0,c=0;c<n.values.length;c++){var f=n.values[c];if("*"!=f.value){var l=o.find("[data-field-id="+f.field+"]"),l=g.Util.getFieldValue(l,!0);if(!(Array.isArray(l)?-1<l.indexOf(f.value):f.value==l||l&&"true"==f.value)||"last"===e&&f.field!=t.data("field-id")){i=!1;break}}}if(i)return n}return null}(e=void 0===e?"rules":e,t,a=void 0===a?[]:a))?r(a.image):(a=g.Util.selectedVariation(o),r(a?a.image_id:s))}var e,t,f,l=["src","height","width","title","srcset","alt","sizes"],d={"data-src":"full_src","data-caption":"caption","data-large_image":"full_src","data-large_image_width":"full_src_w","data-large_image_height":"full_src_h"},u=!0,p=o.find(".images .wp-post-image"),a=o.find("[data-wapf-gi]"),s=null;p.length&&a.length&&(jQuery(document).trigger("wapf:delete_var"),s=p.closest("div").data("wapf-att-id"),o.find("[data-wapf-att-id]").each(function(e,t){var a,r,n,i=jQuery(t),t=i.data("wapf-att-id");c[t]||(c[t]=(a={image_id:(i=i).attr("data-wapf-att-id")},r=i.find("img"),n=r.data("o_src")?"data-o_":"",l.forEach(function(e){a[e]=r.attr(n+e)}),a.thumb_src=i.data("thumb"),Object.keys(d).forEach(function(e){a[d[e]]=r.attr(n+e)}),wapf_config.slider_support||(a.srcset=" "),a))}),!(e=o.find('input[name="variation_id"]')).length||(t=o.find("form.cart").data("product_variations"))&&t.forEach(function(e){e.image.image_id=e.image_id,c[e.image_id]=e.image}),f=[],a.each(function(e,t){var a=jQuery(t),t=a.data("wapf-gi"),r=a.data("group");f[r]=t.rules.reverse(),t.images.forEach(function(e){c[e.image_id]=e}),a.find(".wapf-input").on("change",function(e){n(a.data("wapf-st"),jQuery(e.currentTarget),f[r])}).filter(":visible").eq(0).trigger("change")}),e.on("change",function(){n("rules",e)}))},t);function t(a){a.data("wapf-iid",Math.random().toString(36).substr(2,6)),this.dependencies(a),new g.Pricing(a),this.quantity(a);var r={};this.productImage(a,r),g.Util.varsViaAjax(a)&&jQuery(document).on("found_variation",function(e,t){g.Util.selectedVar=t,g.Util.doDependencies(a),r[t.variation_id]=t,g.Pricing.calculateAll(a)}),a.on("click",".wapf-swatch",function(){var e,t,a,r,n=jQuery(this),i=n.find(".wapf-input");i.is(":disabled")||(e="wapf-checked",t="1"==i.data("is-required"),a=n.closest(".wapf-swatch-wrapper").find(".wapf-swatch"),r=function(){n.toggleClass(e),i.prop("checked",!i.prop("checked")).trigger("change")},i.is(":radio")?t?(a.removeClass(e),i.prop("checked",!0).trigger("change"),n.addClass(e)):(a.not(n).removeClass(e),r()):r())}),a.on("change","input[type=checkbox]",function(){var e,t,a=jQuery(this),r=a.data("maxc"),n=a.data("minc");(n||r)&&(e=(t=a.closest(".wapf-field-container").find("input[type=checkbox]")).filter("input:checked").length,t=t.not(":checked"),r&&t.prop("disabled",r<=e),n&&t.prop("required",!(!a.data("is-required")&&!e)&&e<n))}),a.on("change",".wapf-checkable input",function(){var e=jQuery(this);e.is(":radio")&&e.closest(".wapf-field-input").find(".wapf-checkable").removeClass("wapf-checked"),e.closest(".wapf-checkable").toggleClass("wapf-checked")});function e(){a.find(".wapf-checkboxes[data-is-required=1],.wapf-swatch-wrapper[data-is-required=1]").each(function(e,t){var a=jQuery(t).find('input[type="checkbox"]'),t=function(){a.filter(":checked").length?a.not(":checked").prop("required",!1):a.first().prop("required",!0)};a.off("change",t).on("change",t),t(),jQuery(document).on("wapf/dependencies",t)})}e(),jQuery(document).on("wapf/cloned",e),jQuery("body").on("adding_to_cart",function(e,t,a){if("object"!=typeof a)return a;if(-1<Object.keys(a).indexOf("wapf_field_groups"))return a;t=t.closest("form.cart").find(".wapf-wrapper :input").serializeArray();if(!t)return a;t.forEach(function(e){var t;-1<e.name.indexOf("[]")?(t=e.name.replace("[]",""),a[t]||(a[t]=[]),a[t].push(e.value)):a[e.name]=e.value})}),jQuery(document).trigger("wapf/init",[a])}g.Frontend=e}(WAPF=WAPF||{}),jQuery(function(a){"product"==wapf_config.page_type?new WAPF.Frontend(a("body")):a("[data-product-page-preselected-id]").each(function(e,t){new WAPF.Frontend(a(t))})}),function(o){var e=(c.fxPriceHints=function(e,t,a){a=o.Filter.apply("wapf/fx/hint",a);var r=o.Util.formatMoney(a,wapf_config.display_options),r=o.Filter.apply("wapf/html/fxhint",(a<0?"":"+")+r);t.is("option")&&t.data("fx-hint")&&t.html(t.data("wapf-label")+" "+t.data("fx-hint").replace(/\.{3}/,r)),t.closest(".has-pricing").find(".wapf-addon-price").html(r)},c.calculateAll=function(e){var t=wapf_config.display_options,a=o.Util.currentProductPrice(e)*o.Util.getQty(e),r=this.calculateOptionTotal(e),n=a+r;n<0&&(n=0);var i=".wapf-",c=o.Util.formatMoney;e.find(i+"product-total").html(c(a,t)),e.find(i+"options-total").html(c(r,t)),e.find(i+"grand-total").html(c(n,t)),e.find(i+"product-totals").show(),jQuery(document).trigger("wapf/pricing",[a,r,a+r,e])},c.calculateOptionTotal=function(n){var i=0;return n.find("[data-wapf-price]").each(function(e,t){var a=jQuery(t),r=o.Util.getFieldType(a),t=null;"fx"===a.data("wapf-pricetype")&&(t=c.getPrice(n,a,i),c.fxPriceHints(n,a,t)),!0!==a.prop("disabled")&&(-1<["checkbox","radio"].indexOf(r)&&!a.is(":checked")||("option"!=r||a.is(":selected")&&!0!==a.closest("select").prop("disabled"))&&a.val()&&(i+=null!==t?t:c.getPrice(n,a,i)))}),i},c.getPrice=function(e,t,a){void 0===a&&(a=0);var r=o.Util.currentProductPrice(e),n=t.data("wapf-pricetype"),i=t.data("wapf-price"),a=t.data("wapf-label")||t.val(),a=this.toAdd(n,r,"fx"===n?i:parseFloat(i||"0"),e,t,a,0);return"fx"===n&&-1===i.indexOf("[price]")&&(a*=t.data("wapf-tax")),a||0},c.toAdd=function(e,t,a,r,n,i,c){var f=o.Util.getQty(r);switch(e){case"percent":return t*(a/100)*f;case"p":return t*(a/100);case"qt":return f*a;case"nr":return i*a;case"nrq":return i*a*f;case"char":return i.length*a;case"charq":return i.length*a*f;case"fx":var l=o.Util.replaceFx(a,f,t,i,r,c),l=o.Util.evalVars(this.variables,l,i,f,t,n,r,c);return o.Util.parseFx(l,r);default:return a}},c.variables=[],c);function c(e){var a;e.find("[data-wapf-price]").length&&(a=e.data("wapf-iid"),c.variables[a]=[],e.find(".wapf-field-group").each(function(e,t){t=jQuery(t).data("variables");t&&(c.variables[a]=c.variables[a].concat(t))}),e.on("keyup change",'.wapf-input,input[name="variation_id"]',function(){c.calculateAll(e)}),e.find("[data-qty-based]").length||e.on("keyup change",":input.qty",function(){c.calculateAll(e)}),c.calculateAll(e))}o.Pricing=e}(WAPF),function(e){var t=(a.add=function(e,t){this.f[e]||(this.f[e]=[]),this.f[e].push(t)},a.apply=function(e,t,a){return this.f[e]&&this.f[e].forEach(function(e){t=e(t,a)}),t},a.f=[],a);function a(){}e.Filter=t}(WAPF),function(l){var e=(g.first=function(e,t,a){for(var r=0;r<e.length;r++)if(e[r][t]===a)return e[r];return null},g.replaceFx=function(e,t,a,r,n,i){return void 0===i&&(i=0),e=e.replace(/\[qty]/g,t).replace(/\[price]/g,a).replace(/\[x]/g,r).replace(/\[options_total]/g,i),l.Filter.apply("fx/replace",e.replace(/\[field\..+?]/g,function(e){return g.getFieldValue(n.find(".wapf-input[data-field-id="+e.replace("[field.","").replace("]","")+"]"))}),{qty:t,base:a,value:r,$parent:n})},g.parseFx=function(c,f,e){void 0===f&&(f=null),void 0===e&&(e=!0),c=c.replace(/&gt;/g,">").replace(/&lt;/g,"<");return l.Filter.apply("wapf/fx/functions",Object.keys(g.formulas)).forEach(function(e){for(var t,a=e+"(";-1<(t=(""+c).indexOf(a));){var r=t+a.length,n=function(e,t){for(var a=1,r=0,n=t;n<e.length;n++)if("("==e[n]&&a++,")"==e[n]&&a===++r)return n;return t}(c,r),i=function(e){for(var t=0,a="",r=[],n=0;n<e.length;n++)";"!=e[n]||t?("("==e[n]&&t++,")"==e[n]&&t--,a+=e[n]):(r.push(a.trim()),a="");return!a.length&&r.length||r.push(a.trim()),r}(c.substring(r,n)),r=g.formulas[e]?g.formulas[e](i,f):"";c=l.Filter.apply("wapf/fx/solve",c.substr(0,t)+r+c.substr(n+1),{func:e,args:i,$parent:f})}}),g.evalFx(c),e?g.evalFx(c):c},g.evalFx=function(e,d){if(void 0===d&&(d=!0),!e)return 0;function u(e){return parseFloat(e)}function p(e,t){return-1<e.indexOf(t)}var s=function(e){var t=!1,a=!1,r=0;if(d&&(e=(""+e).replace(/[^\d.+\-*\/()]/gi,"")),p(e,"(")&&p(e,")")){var n=/\(([\d.+\-*\/]+)\)/;if(1<(f=e.match(n)||[]).length)return s(e.replace(n,s(f[1])))}if(e=e.replace("(","").replace(")",""),p(e,"/")||p(e,"*"))for(var t=!0,i=["/","*"];i.length;)for(var c=i.pop();c&&p(e,c);){var f,n=new RegExp("([\\d.]+)\\"+c+"(\\-?[\\d.]+)");if(!(2<(f=e.match(n)||[]).length))return 0;"+"==c&&(r=u(f[1])+u(f[2])),"-"==c&&(r=u(f[1])-u(f[2])),"*"==c&&(r=u(f[1])*u(f[2])),"/"==c&&(r=u(f[1])/u(f[2])),e=(e=e.replace(n,r)).replace("++","+").replace("--","+").replace("-+","-").replace("+-","-")}if(p(e,"+")||p(e,"-")){var a=!0,l=(e=e.replace("--","+")).match(/([\d.]+|[+\-])/g)||[];if(0<l.length)for(var r=0,c="+",o=0;o<l.length;o++)"+"==l[o]||"-"==l[o]?c=l[o]:r="+"==c?r+u(l[o]):r-u(l[o])}return r=!t&&!a?u(e):r};return s(e)},g.cloneField=function(e,t,a){if(!a)return e;t=t.find('[for="'+e+'"]').first();return t.length&&""==t.data("qty-based")?e+"_clone_"+a:e},g.cloneFx=function(e,r,n){return n?e.replace(/\[(field\.)(.+?)]/g,function(e,t,a){return"["+t+g.cloneField(a,r,n)+"]"}):e},g.evalVars=function(l,e,o,d,u,p,s,t){return e.replace(/\[var_.+?]/g,function(e){var t=s.data("wapf-iid");if(l[t]){var a=g.first(l[t],"name",e.replace(/\[var_|]/g,""));if(a){for(var r=a.default,n=p.data("clone")||0,i=0;i<a.rules.length;i++){var c=a.rules[i],f=g.cloneField(c.field,s,n);if(g.isValidRule(s,f,c.condition,c.value||"")){r=c.variable;break}}return g.parseFx(g.replaceFx(g.cloneFx(r,s,n),d,u,o,s),s)}}return"0"})},g.getFieldType=function(e){if(e.is("input"))return e.data("df")?"date":e.data("is-file")?"file":e.attr("type");for(var t=["select","textarea","option"],a=0;a<t.length;a++)if(e.is(t[a]))return t[a];return""},g.getFieldValue=function(e,a){void 0===a&&(a=!1);var t=g.getFieldType(e),r=e.attr("name"),n=jQuery('input[name="'+r+'"]:checked');switch(t){case"select":var i=e.val();return a?i||"":i?e.find("option:selected").data("wapf-label"):"";case"radio":i=n.val();return a?i||"":n.length?n.data("wapf-label"):"";case"checkbox":if("[]"!=r.substring(r.length-2,r.length))return e.is(":checked");var c=[];return n.each(function(e,t){t=jQuery(t);c.push(a?t.val():t.data("wapf-label"))}),c;default:return e.val()}},g.getQty=function(e){e=e.find("[name=quantity]");return e.length?parseInt(e.val()||1):1},g.currentProductType=function(e){return e.find(".wapf-product-totals").data("product-type")},g.currentProductPrice=function(e){var t=g.selectedVariation(e),a=0,a="variable"==g.currentProductType(e)?t?t.display_price:0:e.find(".wapf-product-totals").data("product-price");return l.Filter.apply("wapf/pricing/base",a,{parent:e})},g.currentVariationId=function(e){e=e.find('input[name="variation_id"]').val();return e?parseInt(e):0},g.varsViaAjax=function(e){return 0==e.find("[data-product_variations]").data("product_variations")},g.selectedVariation=function(e){var t=e.find("[data-product_variations]").data("product_variations");if(!t)return g.selectedVar;e=g.currentVariationId(e);return e?g.first(t,"variation_id",e):null},g.unformat=function(e,t){if(void 0===t&&(t=","),"number"==typeof e)return e;var a=new RegExp("[^0-9-"+t+"]","g"),t=parseFloat(e.replace(/\((.*)\)/,"-$1").replace(a,"").replace(t,"."));return isNaN(t)?0:t},g.formatNumber=function(e,t,a,r){e=g.unformat(e,r);var n,i,c=(n=Math.abs(e),i=t,Number(Math.round(n+"e"+i)+"e-"+i).toFixed(i)),f=e<0?"-":"",l=parseInt(c,10)+"",e=3<l.length?l.length%3:0;return f+(e?l.substr(0,e)+a:"")+l.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+a)+(t?r+c.split(".")[1]:"")},g.formatMoney=function(e,t){return e<0&&t.format.replace("%2$s","-%2$s"),t.format.replace("%1$s",t.symbol).replace("%2$s",g.formatNumber(e,t.decimals||0,t.thousand,t.decimal))},g.isValidRule=function(e,t,a,r){var n=null;if("qty"==t)n=g.getQty(e);else{var i=e.find('[data-field-id="'+t+'"]').first();if(!i.length)return!1;if(-1<a.indexOf("product_var")||-1<a.indexOf("patts")){t=g.currentProductType(e);if(-1===t.indexOf("variable")&&-1===t.indexOf("variation"))return!0;var c=g.selectedVariation(e);if(null==c)return!1;function f(){for(var e=0;e<l.length;e++){var t=l[e].split("|");if(c.attributes&&c.attributes["attribute_pa_"+t[0]]&&("*"==t[1]||c.attributes["attribute_pa_"+t[0]]===t[1]))return!0}return!1}var l=r.split(","),o=""+c.variation_id;switch(a){case"product_var":return-1<l.indexOf(o);case"!product_var":return-1==l.indexOf(o);case"patts":return!0===f();case"!patts":return!1===f()}}if(i.closest(".wapf-field-container").hasClass("wapf-hide"))return!1;n=g.getFieldValue(i,!0),"date"===g.getFieldType(i)&&r&&(n=i.data("selected"),i=r.split("-"),r=new Date(parseInt(i[2]),parseInt(i[0])-1,parseInt(i[1])))}switch("number"==typeof n&&(n=n.toString()),a){case"check":return 1==n;case"!check":return 0==n;case"==":return Array.isArray(n)?-1<n.indexOf(r):n instanceof Date?n&&n.getTime()===r.getTime():n==r;case"!=":return Array.isArray(n)?-1==n.indexOf(r):n instanceof Date?n&&n.getTime()!=r.getTime():n!=r;case"empty":return n==[]||""==n;case"!empty":return n!=[]&&""!=n;case"==contains":return-1<n.indexOf(r);case"!=contains":return-1===n.indexOf(r);case"lt":return parseFloat(n)<parseFloat(r);case"gt":return parseFloat(n)>parseFloat(r);case"gtd":return n&&n.getTime()>r.getTime();case"ltd":return n&&n.getTime()<r.getTime()}return!1},g.doDependencies=function(r){function n(e){var t=e.data("wapf-d");if(!Array.isArray(t))return!0;for(var a=0;a<t.length;a++)if(function(e){for(var t=0;t<e.length;t++)if(!g.isValidRule(r,e[t].field,e[t].condition,e[t].value||""))return!1;return!0}(t[a].rules))return!0;return!1}var i="disabled",c=!1;r.find(".has-conditions").each(function(e,t){var a=jQuery(t),r=n(a),t=a.hasClass("wapf-hide");(r&&t||!r&&!t)&&(c=!0),a[(r?"remove":"add")+"Class"]("wapf-hide"),a.find(".wapf-tf-h").prop(i,!r),a.find(".wapf-input").each(function(e,t){t=jQuery(t);t.prop("required",!!r&&t.data("is-required")).prop(i,!r)})}),c&&jQuery(document).trigger("wapf/dependencies")},g.doQtyLogic=function(o,e){function p(f,l,e,t){function a(e){var t=e.data("wapf-d");t&&((t=JSON.parse(JSON.stringify(t))).forEach(function(e){e.rules.forEach(function(e){var t=o.find('[for="'+e.field+'"]').first();t.length&&(""==t.data("qty-based")||t.closest(".wapf-section[data-qty-based]").length)&&(e.field=e.field+"_clone_"+l)})}),e.attr("data-wapf-d",JSON.stringify(t)).data("wapf-d",t))}var r=f.find(".wapf-input,.wapf-tf-h").data("clone",l),n=f.find(".has-conditions");return a(f),n.each(function(e,t){a(jQuery(t))}),r.each(function(e,t){var a=jQuery(t),r=a.data(a.hasClass("wapf-tf-h")?"fid":"field-id"),n=r+"_clone_"+l;["name","id","data-field-id","data-fid"].forEach(function(e){a.attr(e)&&a.attr(e,a.attr(e).replace(r,n))}),a.data("field-id",n);function i(e){var t;"fx"==e.data("wapf-pricetype")&&(t=g.cloneFx(e.data("wapf-price"),o,l),e.attr("data-wapf-price",t).data("wapf-price",t))}i(a),a.find("option").data("clone",l).each(function(e,t){i(jQuery(t))});var c=a.attr("id"),t=f.find('label[for="'+c+'"]');t.length&&(t.attr("for",c=c+"_"+l),a.attr("id",c))}),f.removeAttr("data-qty-based data-clone-txt"),r=f.find(".wapf-field-label label > span:first-child"),t||r.html(e),f}var s=g.getQty(o);e.each(function(e,t){var a=jQuery(t),r=a.data("dupe")||[],n=a.attr("for"),i=r.length,c=s-(i+1),f=a.hasClass("wapf-section");if(0!=c){if(0<c)for(var l=0;l<c;l++){var o=i+l+2,d=(a.data("clone-txt")||"").replace("{n}",o),u=p(a.clone(!0),o,d,f);u.insertAfter(r.length?r[r.length-1]:a),f&&d&&u.prepend('<div class="wapf-clone-title"><label>'+d+"</label></div>"),jQuery(document).trigger("wapf/cloned",[n,o,u]),r.push(u)}else r.splice(c,-1*c).forEach(function(e){e.remove()});a.data("dupe",r)}}),l.Pricing.calculateAll(o)},g.formulas={len:function(e){return""+e[0].length},min:function(e,t){return Math.min.apply(null,e.map(function(e){return g.parseFx(e,t)}))},max:function(e,t){return Math.max.apply(null,e.map(function(e){return g.parseFx(e,t)}))}},g.selectedVar=null,g);function g(){}l.Util=e}(WAPF);